(function(e,t,n){t.infinitescroll=function(n,r,i){this.element=t(i);if(!this._create(n,r)){this.failed=true}};t.infinitescroll.defaults={loading:{finished:n,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:n},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,currentViewPage:1,currPage:1},callback:n,debug:false,behavior:n,binder:t(e),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:false,pathParse:n,dataType:"html",appendCallback:true,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:n,path:n,defaultCallback:function(e,t){}};t.infinitescroll.prototype={_binding:function(t){var r=this,i=r.options;i.v="2.0b2.111027";if(!!i.behavior&&this["_binding_"+i.behavior]!==n){this["_binding_"+i.behavior].call(this);return}if(t!=="bind"&&t!=="unbind"){this._debug("Binding value  "+t+" not valid");return false}if(t=="unbind"){this.options.binder.unbind("smartscroll.infscr."+r.options.infid)}else{this.options.binder[t]("smartscroll.infscr."+r.options.infid,function(){r.scroll()})}this._debug("Binding",t)},_create:function(r,i){var s=t.extend(true,{},t.infinitescroll.defaults,r);if(!this._validate(r)){return false}this.options=s;var o=t(s.nextSelector).attr("href");if(!o){this._debug("Navigation selector not found");return false}s.path=this._determinepath(o);s.contentSelector=s.contentSelector||this.element;s.loading.selector=s.loading.selector||s.contentSelector;s.loading.msg=s.loading.msg||t('<div id="infscr-loading"><img alt="Loading..." src="'+s.loading.img+'" /><div>'+s.loading.msgText+"</div></div>");(new Image).src=s.loading.img;s.pixelsFromNavToBottom=t(document).height()-t(s.navSelector).last().offset().top;s.loading.start=s.loading.start||function(){s.loading.msg.appendTo(s.loading.selector).show(s.loading.speed,function(){beginAjax(s)})};s.loading.finished=s.loading.finished||function(){s.loading.msg.fadeOut("normal")};s.callback=function(e,r){if(!!s.behavior&&e["_callback_"+s.behavior]!==n){e["_callback_"+s.behavior].call(t(s.contentSelector)[0],r)}if(i){i.call(t(s.contentSelector)[0],r,s)}};s.pageBreakPxLocation=[0,this._calculateCurrentPageBreakPx()];this._setup();return true},_debug:function(){if(this.options&&this.options.debug){return e.console&&console.log.call(console,arguments)}},_determinepath:function(t){var r=this.options;if(!!r.behavior&&this["_determinepath_"+r.behavior]!==n){this["_determinepath_"+r.behavior].call(this,t);return}if(t.match(/^(.*?)\b\d/)){data=t.match(/^(.*?)\b\d\b(.*?$)/).slice(1);this.options.state.currPage=t.split("/").slice(2);this.options.state.currPage=this.options.state.currPage[this.options.state.currPage.length-1]-1;return data}if(!!r.pathParse){this._debug("pathParse manual");return r.pathParse(t,this.options.state.currPage+1)}else if(t.match(/^(.*?)\b2\b(.*?$)/)){t=t.match(/^(.*?)\b2\b(.*?$)/).slice(1)}else if(t.match(/^(.*?)2(.*?$)/)){if(t.match(/^(.*?page=)2(\/.*|$)/)){t=t.match(/^(.*?page=)2(\/.*|$)/).slice(1);return t}t=t.match(/^(.*?)2(.*?$)/).slice(1)}else{if(t.match(/^(.*?page=)1(\/.*|$)/)){t=t.match(/^(.*?page=)1(\/.*|$)/).slice(1);return t}else{this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");r.state.isInvalidPage=true}}this._debug("determinePath",t);return t},_error:function(t){var r=this.options;if(!!r.behavior&&this["_error_"+r.behavior]!==n){this["_error_"+r.behavior].call(this,t);return}if(t!=="destroy"&&t!=="end"){t="unknown"}this._debug("Error",t);if(t=="end"){this._showdonemsg()}r.state.isDone=true;r.state.currPage=1;r.state.isPaused=false;this._binding("unbind")},_loadcallback:function(i,s){var o=this.options,u=this.options.callback,a=o.state.isDone?"done":!o.appendCallback?"no-append":"append",f;if(!!o.behavior&&this["_loadcallback_"+o.behavior]!==n){this["_loadcallback_"+o.behavior].call(this,i,s);return}switch(a){case"done":this._showdonemsg();return false;break;case"no-append":if(o.dataType=="html"){s="<div>"+s+"</div>";s=t(s).find(o.itemSelector)}break;case"append":var l=i.children();if(l.length==0){return this._error("end")}f=document.createDocumentFragment();while(i[0].firstChild){f.appendChild(i[0].firstChild)}this._debug("contentSelector",t(o.contentSelector)[0]);t(o.contentSelector)[0].appendChild(f);o.pageBreakPxLocation[o.pageBreakPxLocation.length]=this._calculateCurrentPageBreakPx();s=l.get();break}o.loading.finished.call(t(o.contentSelector)[0],o);if(o.animate){var c=t(e).scrollTop()+t("#infscr-loading").height()+o.extraScrollPx+"px";t("html,body").animate({scrollTop:c},800,function(){o.state.isDuringAjax=false})}if(!o.animate)o.state.isDuringAjax=false;u(this,s);this.options.defaultCallback(this,s);var h=this.options.path.join(this.options.state.currPage);var p=(RegExp(name+"="+"(.+?)(&|$)").exec(e.location.href)||[,null])[1];if(h.indexOf("search")>=0)h+="?q="+p;e.history.replaceState(null,null,h)},_nearbottom:function(){var i=this.options,s=0+t(document).height()-i.binder.scrollTop()-t(e).height();if(!!i.behavior&&this["_nearbottom_"+i.behavior]!==n){return this["_nearbottom_"+i.behavior].call(this)}this._debug("math:",s,i.pixelsFromNavToBottom);return s-i.bufferPx<i.pixelsFromNavToBottom},_updateUrlForPageIfNeeded:function(){var t=this.options;if(!!t.behavior&&this["_checkWithinPageBounds_"+t.behavior]!==n){return this["_checkWithinPageBounds_"+t.behavior].call(this)}for(var r=0;r<t.pageBreakPxLocation.length;r++){var i=t.binder.scrollTop()>=t.pageBreakPxLocation[r];var s=r+1;if(i){var o=r+1===t.pageBreakPxLocation.length;var u=t.binder.scrollTop()<t.pageBreakPxLocation[r+1];if(o||u){var a=t.state.currentViewPage!==s;if(a){this._updateUrl(s);return}}}}},_updateUrl:function(n){this._debug("url needs update to "+n);var r=this.options;r.state.currentViewPage=n;var i=r.path.join(n);e.history.replaceState(null,null,i)},_pausing:function(t){var r=this.options;if(!!r.behavior&&this["_pausing_"+r.behavior]!==n){this["_pausing_"+r.behavior].call(this,t);return}if(t!=="pause"&&t!=="resume"&&t!==null){this._debug("Invalid argument. Toggling pause value instead")}t=t&&(t=="pause"||t=="resume")?t:"toggle";switch(t){case"pause":r.state.isPaused=true;break;case"resume":r.state.isPaused=false;break;case"toggle":r.state.isPaused=!r.state.isPaused;break}this._debug("Paused",r.state.isPaused);return false},_setup:function(){var t=this.options;if(!!t.behavior&&this["_setup_"+t.behavior]!==n){this["_setup_"+t.behavior].call(this);return}this._binding("bind");return false},_showdonemsg:function(){var r=this.options;if(!!r.behavior&&this["_showdonemsg_"+r.behavior]!==n){this["_showdonemsg_"+r.behavior].call(this);return}r.loading.msg.find("img").hide().parent().find("div").html(r.loading.finishedMsg).animate({opacity:1},2e3,function(){t(this).parent().fadeOut("normal")});r.errorCallback.call(t(r.contentSelector)[0],"done")},_validate:function(n){for(var r in n){if(r.indexOf&&r.indexOf("Selector")>-1&&t(n[r]).length===0){this._debug("Your "+r+" found no elements.");return false}}return true},_calculateCurrentPageBreakPx:function(){var n=this.options;return 0+t(document).height()-n.pixelsFromNavToBottom},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=true;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(i){var s=this,o=s.options,u=o.path,a,f,l,c,h,i=i||null,p=!!i?i:o.state.currPage;beginAjax=function(i){i.state.currPage++;s._debug("heading into ajax",u);a=t(i.contentSelector).is("table")?t("<tbody/>"):t("<div/>");l=u.join(i.state.currPage);var o=(RegExp(name+"="+"(.+?)(&|$)").exec(e.location.href)||[,null])[1];if(l.indexOf("search")>=0)l+="?q="+o;c=i.dataType=="html"||i.dataType=="json"?i.dataType:"html+callback";if(i.appendCallback&&i.dataType=="html")c+="+callback";switch(c){case"html+callback":s._debug("Using HTML+Callback via .load() method");a.load(l+" "+i.itemSelector,null,function(t){s._loadcallback(a,t)});break;case"html":s._debug("Using "+c.toUpperCase()+" via $.ajax() method");t.ajax({url:l,dataType:i.dataType,complete:function(t,n){h=typeof t.isResolved!=="undefined"?t.isResolved():n==="success"||n==="notmodified";h?s._loadcallback(a,t.responseText):s._error("end")}});break;case"json":s._debug("Using "+c.toUpperCase()+" via $.ajax() method");t.ajax({dataType:"json",type:"GET",url:l,success:function(e,t,r){h=typeof r.isResolved!=="undefined"?r.isResolved():t==="success"||t==="notmodified";if(i.appendCallback){if(i.template!=n){var o=i.template(e);a.append(o);h?s._loadcallback(a,o):s._error("end")}else{s._debug("template must be defined.");s._error("end")}}else{h?s._loadcallback(a,e):s._error("end")}},error:function(e,t,n){s._debug("JSON ajax request failed.");s._error("end")}});break}};if(!!o.behavior&&this["retrieve_"+o.behavior]!==n){this["retrieve_"+o.behavior].call(this,i);return}if(o.state.isDestroyed){this._debug("Instance is destroyed");return false}o.state.isDuringAjax=true;o.loading.start.call(t(o.contentSelector)[0],o)},scroll:function(){var t=this.options,r=t.state;if(!!t.behavior&&this["scroll_"+t.behavior]!==n){this["scroll_"+t.behavior].call(this);return}if(r.isDuringAjax||r.isInvalidPage||r.isDone||r.isDestroyed||r.isPaused)return;this._updateUrlForPageIfNeeded();if(!this._nearbottom())return;this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(n){if(t.isPlainObject(n)){this.options=t.extend(true,this.options,n)}}};t.fn.infinitescroll=function(n,r){var i=typeof n;switch(i){case"string":var s=Array.prototype.slice.call(arguments,1);this.each(function(){var e=t.data(this,"infinitescroll");if(!e){return false}if(!t.isFunction(e[n])||n.charAt(0)==="_"){return false}e[n].apply(e,s)});break;case"object":this.each(function(){var e=t.data(this,"infinitescroll");if(e){e.update(n)}else{e=new t.infinitescroll(n,r,this);if(!e.failed){t.data(this,"infinitescroll",e)}}});break}return this};var r=t.event,i;r.special.smartscroll={setup:function(){t(this).bind("scroll",r.special.smartscroll.handler)},teardown:function(){t(this).unbind("scroll",r.special.smartscroll.handler)},handler:function(e,n){var r=this,s=arguments;e.type="smartscroll";if(i){clearTimeout(i)}i=setTimeout(function(){t.event.handle.apply(r,s)},n==="execAsap"?0:100)}};t.fn.smartscroll=function(e){return e?this.bind("smartscroll",e):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);